<!DOCTYPE html>
<html class="light" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WordMasters Royale</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Lexend:wght@700&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
  
  <style>
    
    @layer utilities {
      .animate-wobble-pop {
        animation: wobble-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
      }
    }
    /* Default body state */
    /* 1. Normal State: Open */
    body, #game-canvas {
        cursor: url('/static/hand_small_open.png') 8 8, auto;
    }

    /* 2. Hovering buttons, links, or inputs: Pointing hand */
    button, a, select, input[type="range"], #chat-toggle, .leaderboard-item {
        cursor: url('/static/hand_small_point.png') 8 8, pointer;
    }

    /* 3. Global Click/Drag: Closed hand snaps shut anywhere on the screen */
    body:active {
        cursor: url('/static/hand_small_closed.png') 8 8, grabbing !important;
    }

    /* 4. Ensure the closed hand persists over buttons when they are clicked */
    button:active, a:active, select:active {
        cursor: url('/static/hand_small_closed.png') 8 8, grabbing !important;
    }

    /* 5. Special case: Text inputs should still show the text I-beam for clarity */
    input[type="text"] {
        cursor: url('/static/bracket_a_vertical.png') 8 8, text !important;
    }

    @keyframes wobble-pop {
      0% { transform: scale(0) rotate(-10deg); opacity: 0; }
      50% { transform: scale(1.4) rotate(5deg); opacity: 1; }
      75% { transform: scale(0.85) rotate(-2deg); }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    :root {
      /* Exact colors from the provided image */
      --primary: #6366F1;
      --bg-slate: #F8FAFC;
      --tile-cream: #FFEDD5;
      --tile-mint: #D1FAE5;
      --tile-lavender: #EDE9FE;
      --tile-blue: #DBEAFE;
    }
    
    .hidden {
      display: none;
    }

    #explosion-viewport {
      perspective: 1000px;
    }

    .split-piece {
      position: absolute;
      inset: 0;
      background: white;
      border-radius: 2.5rem;
      z-index: 50;
      transition: transform 1.5s cubic-bezier(0.25, 1, 0.5, 1), opacity 1.5s ease;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
    }

    .tl {
      clip-path: inset(0 50% 50% 0);
    }

    .tr {
      clip-path: inset(0 0 50% 50%);
    }

    .bl {
      clip-path: inset(50% 50% 0 0);
    }

    .br {
      clip-path: inset(50% 0 0 50%);
    }

    .throw-tl {
      transform: translate(-50%, -50%) rotate(-30deg) scale(0.5);
      opacity: 0;
    }

    .throw-tr {
      transform: translate(50%, -50%) rotate(30deg) scale(0.5);
      opacity: 0;
    }

    .throw-bl {
      transform: translate(-50%, 50%) rotate(-15deg) scale(0.5);
      opacity: 0;
    }

    .throw-br {
      transform: translate(50%, 50%) rotate(15deg) scale(0.5);
      opacity: 0;
    }

    .card-content {
      width: 400px;
      height: 400px;
      position: absolute;
      top: 0;
      left: 0;
    }

    /* Leaderboard Styles */
    #leaderboard {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .leaderboard-item {
      transition: all 0.4s ease;
      background-color: white;
      border: 1px solid #E2E8F0;
      border-radius: 1rem;
    }

    /* Active User Highlight Color */
    .user-active {
      background-color: #EEF2FF;
      border: 2px solid var(--primary);
    }

    @keyframes pulse-border {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.2);
      }

      50% {
        transform: scale(1.02);
        box-shadow: 0 0 0 8px rgba(99, 102, 241, 0);
      }

      100% {
        transform: scale(1);
      }
    }

    .score-pulse {
      animation: pulse-border 0.6s ease-out;
      z-index: 10;
    }
    #game-logo {
      position: fixed; /* 'fixed' ensures it stays even if screen scrolls */
      bottom: 20px;
      left: 20px;
      width: 150px;
      height: auto;
      z-index: 999; /* Stay above canvas, chat, and countdown */
      pointer-events: none; /* VERY IMPORTANT: Clicks go through to the game board */
      user-select: none;
      filter: drop-shadow(0px 4px 8px rgba(0, 0, 0, 0.3));
    }

    /* Header image specific styling to keep it clean */
    header img {
      user-select: none;
      -webkit-user-drag: none;
    }
  </style>
</head>

<body class="font-body bg-[#eaebed] min-h-screen overflow-hidden">

  <div id="start-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#eac5ff];">
    <div id="explosion-viewport" class="relative w-[400px] h-[400px]">

      <div id="setup-section"
        class="absolute inset-0 bg-white p-10 rounded-[2.5rem] shadow-xl flex flex-col justify-center opacity-0 scale-90 transition-all duration-700">
        <button id="lobbyLogoutBtn"
          class="ml-auto flex items-center gap-1.5 px-3 py-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all font-bold text-xs">
          <span class="material-icons-round text-md">logout</span>
        </button>

        <div class="text-center mb-8">
          <h2 class="text-2xl font-display font-bold text-slate-900">Welcome, <span id="user-name"
              class="text-[#6366F1]">Player</span></h2>
        </div>
        <div class="flex p-1 bg-slate-100 rounded-2xl mb-4">
          <button id="createTab"
            class="flex-1 py-2.5 rounded-xl font-bold text-sm bg-white shadow text-[#6366F1]">Create</button>
          <button id="joinTab" class="flex-1 py-2.5 rounded-xl font-bold text-sm text-slate-400">Join</button>
        </div>
        <div id="joinBox" class="hidden mb-4">
          <input id="roomInput"
            class="w-full rounded-xl p-4 bg-slate-50 border border-slate-200 outline-none focus:ring-2 focus:ring-[#6366F1]"
            placeholder="Room Code" />
        </div>
        <button id="startBtn"
          class="w-full bg-[#6366F1] text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-[#4F46E5]">Start
          Game</button>
        <div id="color-picker-container" class="hidden mt-6 border-t border-slate-100">
          <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block">Your Player
            Color</label>
          <div class="relative flex items-center gap-4">
            <div id="color-preview" class="w-10 h-10 rounded-xl shadow-inner border-2 border-white bg-[#6366F1]"></div>
            <input type="range" id="hue-slider" min="0" max="360" value="231"
              class="flex-1 h-3 rounded-lg appearance-none cursor-pointer outline-none"
              style="background: linear-gradient(to right, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%);">
          </div>
        </div>
      </div>

      <div class="split-piece tl">
        <div class="card-content"></div>
      </div>
      <div class="split-piece tr">
        <div class="card-content"></div>
      </div>
      <div class="split-piece bl">
        <div class="card-content"></div>
      </div>
      <div class="split-piece br z-[60]">
        <div class="card-content"></div>
      </div>
      
      <div id="auth-overlay"
        class="absolute inset-0 z-[70] flex flex-col items-center justify-end pb-12 pointer-events-none">
        <div id="googleButtonContainer" class="pointer-events-auto mb-3"></div>
        <button id="customGuestBtn"
          class="pointer-events-auto w-[250px] py-3 bg-slate-100 text-slate-600 rounded-full
                                          font-semibold border border-slate-200 shadow-sm active:scale-95 transition-transform">Join as
          Guest</button>
      </div>
    </div>
  </div>

  <div id="lobby-screen" class="hidden fixed inset-0 z-[80] bg-slate-50 flex items-center justify-center p-6">
    <div class="w-full max-w-2xl bg-white rounded-[2.5rem] shadow-2xl p-10 flex flex-col h-[600px]">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-3xl font-bold text-slate-900">Game Lobby</h2>
          <p class="text-slate-400 font-medium">Waiting for players...</p>
        </div>
        <div class="bg-indigo-50 px-4 py-2 rounded-2xl border border-indigo-100">
          <span class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest block">Room Code</span>
          <span id="lobby-room-code" class="text-2xl font-mono font-bold text-indigo-600">----</span>
        </div>
      </div>

      <div class="flex-1 overflow-y-auto mb-8 pr-2">
        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4 block">Players Joined</label>
        <div id="lobby-player-list" class="grid grid-cols-2 gap-4">
        </div>
      </div>

      <div class="border-t border-slate-100 pt-8 flex gap-4">
        <div class="flex-1">
          <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block">Game Mode</label>

          <select id="lobby-settings-mode"
            class="hidden w-full rounded-xl border-slate-200 text-sm font-bold bg-slate-50">
            <option value="classic">Classic (5min)</option>
            <option value="blitz">Blitz (3min)</option>
            <option value="bullet">Bullet (1min)</option>
          </select>

          <div id="lobby-mode-text"
            class="hidden px-4 py-2.5 bg-slate-100 rounded-xl text-sm font-bold text-slate-600 border border-slate-200">
            Classic Royale
          </div>
        </div>

        <div class="flex-1">
          <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block">Language</label>

          <select id="lobby-settings-lang"
            class="hidden w-full rounded-xl border-slate-200 text-sm font-bold bg-slate-50">
            <option value="en">English</option>
            <option value="ko">한국어</option>
          </select>

          <div id="lobby-lang-text"
            class="hidden px-4 py-2.5 bg-slate-100 rounded-xl text-sm font-bold text-slate-600 border border-slate-200">
            English
          </div>
        </div>

        <button id="lobby-start-match-btn"
          class="hidden flex-[2] bg-[var(--user-color)] text-white rounded-2xl font-bold shadow-lg hover:brightness-95 transition-all">
          Start Match
        </button>
        <div id="lobby-wait-msg"
          class="flex-[2] bg-slate-100 text-slate-400 rounded-2xl flex items-center justify-center font-bold text-sm italic">
          Waiting for host...
        </div>
      </div>
    </div>
  </div>

  <div id="game-ui" class="hidden flex flex-col h-screen w-full">
    <div id="start-countdown-overlay" class="hidden fixed inset-0 z-[200] items-center justify-center backdrop-blur-md bg-white/30 transition-opacity ease-in-out">
      <div class="text-center">
        <div id="countdown-number" class="text-[12rem] font-display font-bold text-[#6366F1] drop-shadow-2xl">
          3
        </div>
        <p class="text-2xl font-bold text-slate-700 uppercase tracking-[0.5em] mt-4">Get Ready!</p>
      </div>
    </div>


    <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8">
      <div id="round-timer-container" class="hidden fixed left-1/2 -translate-x-1/2 z-[90] flex flex-col items-center">
        <div class="bg-white/80 backdrop-blur px-6 py-2 rounded-2xl shadow-lg border border-slate-200 flex items-center gap-3">
          <span class="material-icons-round text-indigo-500 animate-pulse">timer</span>
          <span id="game-timer-display" class="font-mono text-2xl font-bold text-slate-800">00:00</span>
        </div>
      </div>

      <header class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8">
        <div class="flex items-center gap-3">
          <a href="https://aciform-untoughly-filomena.ngrok-free.dev" target="_blank" class="hover:opacity-80 transition-opacity">
            <img src="/static/Logo.png" alt="game-logo" class="h-10 w-auto object-contain">
          </a>
        </div>

        <div class="flex items-center gap-4">
          </div>
      </header>

      <div class="flex items-center gap-4">
        <div id="room-display" class="flex items-center bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
          <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mr-2">Room</span>
          <span id="room-id-text" class="font-mono font-bold text-[#6366F1] tracking-wider">------</span>
        </div>

        <div class="h-8 w-[1px] bg-slate-200 mx-2"></div>

        <div id="player-info" class="font-semibold text-slate-600 flex items-center gap-2">
          <span class="material-icons-round text-slate-400">account_circle</span>
          <span id="header-user-name">Guest</span>
        </div>

        <div class="h-8 w-[1px] bg-slate-200 mx-2"></div>

        <button id="logoutBtn"
          class="flex items-center gap-1.5 px-3 py-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all font-bold text-xs">
          <span class="material-icons-round text-sm">logout</span>
          <span>Logout</span>
        </button>
      </div>
    </header>

    <main class="flex flex-1 overflow-hidden">
      <aside class="w-80 border-r border-slate-200 bg-white p-6">
        <h2 class="font-bold text-lg mb-6 text-slate-900 flex items-center gap-2">
          <span class="material-icons-round text-amber-500">leaderboard</span> Leaderboard
        </h2>
        <div id="leaderboard">
        </div>
      </aside>

      <div class="flex-1 relative bg-[#F8FAFC]">
        <canvas id="game-canvas" class="w-full h-full"></canvas>
        <button id="reset-cam"
          class="absolute bottom-6 right-6 p-3 bg-white border border-slate-200 text-slate-400 rounded-full shadow-md hover:text-[#6366F1]">
          <span class="material-icons-round">center_focus_strong</span>
        </button>
      </div>
    </main>

  <div id="winner-overlay" class="hidden fixed inset-0 z-[300] flex items-center justify-center backdrop-blur-xl bg-white/30 transition-all duration-700 opacity-0">
    <div class="text-center p-12 bg-white rounded-[3rem] shadow-2xl border border-slate-200 scale-90 transition-transform duration-700" id="winner-card">
      <div class="mb-6 inline-block p-4 bg-yellow-100 rounded-full">
        <span class="material-icons-round text-6xl text-yellow-500 animate-bounce">emoji_events</span>
      </div>
      <h2 class="text-2xl font-bold text-slate-500 uppercase tracking-widest mb-2">Champion</h2>
      <h1 id="winner-name" class="text-6xl font-display font-black text-slate-900 mb-4">Player One</h1>
      <div class="text-3xl font-bold text-[#6366F1]" id="winner-score">2,450 pts</div>
      
      <div class="mt-8 text-slate-400 font-medium italic">
        Returning to lobby in <span id="return-countdown">5</span>s...
      </div>
    </div>
  </div>

  <template id="login-template">
    <div class="w-[400px] h-[400px] p-10 flex flex-col items-center text-center pt-10 bg-white">
      <img src="/static/Logo.png" alt="game-logo">
    </div>
  </template>
  <script type="module" src="/static/ConnectionManager.js"></script>
</body>

</html>